{% extends 'base.html.twig' %}

{% block title %}Admin Dashboard | {{ parent() }}{% endblock %}

{% block body %}
    <div class="body-container">

        <h1 class="title">Administration</h1>

        <hr>

        <div style="
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2em;
            margin-top: 2em;
        ">
            <div>
                <h2>Gestion des lieux</h2>
                <div style="display: flex; align-items: baseline;">
                    <p style="margin-right: 0.5em">Vous pouvez ajouter un lieu sélectionnable pour les sorties :</p>
                    <a href="{{ path('admin_gestion_lieux') }}" class="generic-button bouton-secondary-color">Page gestion des lieux</a>
                </div>
            </div>
            <div>
                <h2>Ajouter une ville</h2>
                <div style="display: flex; align-items: baseline;">
                    <p style="margin-right: 0.5em">Vous pouvez ajouter une ville sélectionnable pour les lieux de sortie :</p>
                    <a href="{{ path('admin_gestion_villes') }}" class="generic-button bouton-secondary-color">Page gestion des villes</a>
                </div>
            </div>
        </div>

        <hr>

        <div class="admin-grid">
            <div class="users-table">
                <h2>Gestion des utilisateurs</h2>
                <div class="app-table-container">
                    <table class="app-table">
                        <thead>
                        <tr>
                            <th>Pseudo</th>
                            <th>Nom</th>
                            <th>Prenom</th>
                            <th>Email</th>
                            <th>Actif</th>
                            <th>Role</th>
                            <th style="width: 1em">Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for utilisateur in utilisateurs %}
                            <tr>
                                <td><a href="{{ path('app_edit', {'id':utilisateur.id}) }}">{{ utilisateur.pseudo }}</a></td>
                                <td>{{ utilisateur.nom }}</td>
                                <td>{{ utilisateur.prenom }}</td>
                                <td>{{ utilisateur.email }}</td>
                                <td style="width: 1em; height: auto;">
                                    {% if utilisateur.actif %}
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
                                            <path fill="#0e4e07"
                                                  d="M530.8 134.1C545.1 144.5 548.3 164.5 537.9 178.8L281.9 530.8C276.4 538.4 267.9 543.1 258.5 543.9C249.1 544.7 240 541.2 233.4 534.6L105.4 406.6C92.9 394.1 92.9 373.8 105.4 361.3C117.9 348.8 138.2 348.8 150.7 361.3L252.2 462.8L486.2 141.1C496.6 126.8 516.6 123.6 530.9 134z"/>
                                        </svg>
                                    {% else %}
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="#a80f0f" d="M183.1 137.4C170.6 124.9 150.3 124.9 137.8 137.4C125.3 149.9 125.3 170.2 137.8 182.7L275.2 320L137.9 457.4C125.4 469.9 125.4 490.2 137.9 502.7C150.4 515.2 170.7 515.2 183.2 502.7L320.5 365.3L457.9 502.6C470.4 515.1 490.7 515.1 503.2 502.6C515.7 490.1 515.7 469.8 503.2 457.3L365.8 320L503.1 182.6C515.6 170.1 515.6 149.8 503.1 137.3C490.6 124.8 470.3 124.8 457.8 137.3L320.5 274.7L183.1 137.4z"/></svg>
                                    {% endif %}
                                </td>
                                <td>
                                    {% for role in utilisateur.roles %}
                                        {{ role }}
                                    {% endfor %}
                                </td>
                                <td style="display: flex; justify-content: center; width: fit-content;">
                                    {% if utilisateur.actif %}
                                        <form method="post" action="{{ path('admin_desactiver', {'id': utilisateur.id}) }}"> <input type="hidden" name="_token" value="{{ csrf_token('desactiver'~utilisateur.id) }}">
                                            <button class="generic-button bouton-danger-color" type="submit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="#ffffff" d="M431.2 476.5L163.5 208.8C141.1 240.2 128 278.6 128 320C128 426 214 512 320 512C361.5 512 399.9 498.9 431.2 476.5zM476.5 431.2C498.9 399.8 512 361.4 512 320C512 214 426 128 320 128C278.5 128 240.1 141.1 208.8 163.5L476.5 431.2zM64 320C64 178.6 178.6 64 320 64C461.4 64 576 178.6 576 320C576 461.4 461.4 576 320 576C178.6 576 64 461.4 64 320z"/></svg> </button>
                                        </form>
                                    {% else %}
                                        <form method="post" action="{{ path('admin_reactiver', {'id': utilisateur.id}) }}"> <input type="hidden" name="_token" value="{{ csrf_token('reactiver'~utilisateur.id) }}">
                                            <button class="generic-button bouton-secondary-color" type="submit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="#ffffff" d="M286 368C384.5 368 464.3 447.8 464.3 546.3C464.3 562.7 451 576 434.6 576L78 576C61.6 576 48.3 562.7 48.3 546.3C48.3 447.8 128.1 368 226.6 368L286 368zM585.7 169.9C593.5 159.2 608.5 156.8 619.2 164.6C629.9 172.4 632.3 187.4 624.5 198.1L522.1 338.9C517.9 344.6 511.4 348.3 504.4 348.7C497.4 349.1 490.4 346.5 485.5 341.4L439.1 293.4C429.9 283.9 430.1 268.7 439.7 259.5C449.2 250.3 464.4 250.6 473.6 260.1L500.1 287.5L585.7 169.8zM256.3 312C190 312 136.3 258.3 136.3 192C136.3 125.7 190 72 256.3 72C322.6 72 376.3 125.7 376.3 192C376.3 258.3 322.6 312 256.3 312z"/></svg></button>
                                        </form>
                                    {% endif %}
                                    {% if not utilisateur.isAdmin() %}
                                        <form method="post" action="{{ path('admin_grant', {'id': utilisateur.id}) }}"> <input type="hidden" name="_token" value="{{ csrf_token('grant'~utilisateur.id) }}">
                                            <button class="generic-button bouton-secondary-color" type="submit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="#ffffff" d="M320 576C461.4 576 576 461.4 576 320C576 178.6 461.4 64 320 64C178.6 64 64 178.6 64 320C64 461.4 178.6 576 320 576zM331.3 188.7L435.3 292.7C439.9 297.3 441.2 304.2 438.8 310.1C436.4 316 430.5 320 424 320L368 320L368 416C368 433.7 353.7 448 336 448L304 448C286.3 448 272 433.7 272 416L272 320L216 320C209.5 320 203.7 316.1 201.2 310.1C198.7 304.1 200.1 297.2 204.7 292.7L308.7 188.7C314.9 182.5 325.1 182.5 331.3 188.7z"/></svg> </button>
                                        </form>
                                    {% else %}
                                        <form method="post" action="{{ path('admin_demote', {'id': utilisateur.id}) }}"> <input type="hidden" name="_token" value="{{ csrf_token('demote'~utilisateur.id) }}">
                                            <button class="generic-button bouton-danger-color" type="submit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="#ffffff" d="M320 64C178.6 64 64 178.6 64 320C64 461.4 178.6 576 320 576C461.4 576 576 461.4 576 320C576 178.6 461.4 64 320 64zM308.7 451.3L204.7 347.3C200.1 342.7 198.8 335.8 201.2 329.9C203.6 324 209.5 320 216 320L272 320L272 224C272 206.3 286.3 192 304 192L336 192C353.7 192 368 206.3 368 224L368 320L424 320C430.5 320 436.3 323.9 438.8 329.9C441.3 335.9 439.9 342.8 435.3 347.3L331.3 451.3C325.1 457.5 314.9 457.5 308.7 451.3z"/></svg> </button>
                                        </form>
                                    {% endif %}
                                    <form method="post" action="{{ path('admin_delete_participant', {'id': utilisateur.id}) }}">
                                        <input type="hidden" name="_token" value="{{ csrf_token('delete_participant'~utilisateur.id) }}">
                                        <button type="submit" class="generic-button bouton-danger-color" title="Supprimer"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="#ffffff" d="M232.7 69.9L224 96L128 96C110.3 96 96 110.3 96 128C96 145.7 110.3 160 128 160L512 160C529.7 160 544 145.7 544 128C544 110.3 529.7 96 512 96L416 96L407.3 69.9C402.9 56.8 390.7 48 376.9 48L263.1 48C249.3 48 237.1 56.8 232.7 69.9zM512 208L128 208L149.1 531.1C150.7 556.4 171.7 576 197 576L443 576C468.3 576 489.3 556.4 490.9 531.1L512 208z"/></svg>
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>

                <a href="{{ path('app_register') }}" class="generic-button bouton-secondary-color"
                   style="margin-top: 1em">Ajouter un participant manuellement</a>
            </div>

            <div class="modbile-disable-margin">
                <div class="form-container" style="width: auto; padding: 1em">
                    <div class="csv-import">
                        <h2>Importer des participants</h2>

                        {% if result is defined and result %}
                            <div class="information-container">
                                <h3>Résultat de l'import</h3>
                                {% if result.imported == result.totalToImport and result.totalToImport > 0 %}
                                    <p><span class="goodnews-text">{{ result.imported }}/{{ result.totalToImport }}</span> participants importés.</p>
                                {% else %}
                                    <p><span class="warning-text">{{ result.imported }}/{{ result.totalToImport }}</span> participants importés.</p>
                                {% endif %}

                                {% if result.errors %}
                                    <ul>
                                        {% for error in result.errors %}
                                            <li class="warning-text">{{ error }}</li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                            </div>
                        {% endif %}

                        <form method="post" enctype="multipart/form-data" style="margin-top: 1em;">
                            <input type="file" name="csv_file" accept=".csv" required>
                            <button class="generic-button bouton-secondary-color" type="submit">Importer</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <style>
        .admin-grid {
            display: grid;
            grid-template-columns: 70% 30%;
            gap: 1em;
            margin-top: 1.5em;
        }

        .modbile-disable-margin {
            margin: 0 0.9em 0 0;
        }

        @media (max-width: 1500px) {
            .admin-grid {
                grid-template-columns: 1fr;
            }

            .modbile-disable-margin {
                margin: 0;
            }
        }
    </style>
{% endblock %}
