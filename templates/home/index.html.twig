{% extends 'base.html.twig' %}

{% block title %}Home | {{ parent() }} {% endblock %}

{% block body %}

    <div class="body-container">
        <div class="flexbox-centered">
            <p style="padding: 1em"><strong>Date du jour :</strong> {{ today|date('d/m/Y') }}</p>
            {% if user %}
                <p style="padding: 1em"><strong>Participant :</strong> {{ user.prenom }} {{ user.nom }}</p>
            {% endif %}
        </div>

        <form method="get" class="information-container">
            <div class="row">
                <div class="col-md-3">
                    <label>Site :</label>
                    <select name="site" class="form-select">
                        <option value="">Tous</option>
                        {% for site in sites %}
                            <option value="{{ site.id }}">{{ site.nom }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="col-md-3">
                    <label>Nom de la sortie :</label>
                    <input type="text" name="search" class="form-control" placeholder="Rechercher...">
                </div>

                <div class="col-md-2">
                    <label>Entre :</label>
                    <input type="date" name="dateDebut" class="form-control">
                </div>
                <div class="col-md-2">
                    <label>et :</label>
                    <input type="date" name="dateFin" class="form-control">
                </div>

                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="generic-button bouton-info-color">Rechercher</button>
                </div>
            </div>

            <div class="mt-3">
                <label><input type="checkbox" name="organisateur"> Sorties dont je suis organisateur/trice</label><br>
                <label><input type="checkbox" name="inscrit"> Sorties auxquelles je suis inscrit/e</label><br>
                <label><input type="checkbox" name="nonInscrit"> Sorties auxquelles je ne suis pas inscrit/e</label><br>
                <label><input type="checkbox" name="passees"> Sorties passées</label>
            </div>
        </form>

        <div class="app-table-container">
            <table class="app-table" style="margin-top: 1.5em">
                <thead>
                <tr>
                    <th>Nom</th>
                    <th>Date de la sortie</th>
                    <th>Clôture</th>
                    <th>Inscrits / Places</th>
                    <th>État</th>
                    <th>Inscrit</th>
                    <th>Organisateur</th>
                    <th style="width: 0.5em">Actions</th>
                </tr>
                </thead>
                <tbody>
                {% for sortie in sorties %}
                    <tr>
                        <td>{{ sortie.nom }}</td>
                        <td>{{ sortie.dateHeureDebut|date('d/m/Y H:i') }}</td>
                        <td>{{ sortie.dateLimiteInscription|date('d/m/Y H:i') }}</td>
                        <td>{{ sortie.participants|length }}/{{ sortie.nbInscriptionMax }}</td>
                        <td>{{ sortie.etat.libelle }}</td>
                        <td style="width: 0.8em; height: auto;">
                            {% if app.user and sortie.estInscrit(app.user) %}
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
                                    <path fill="#0e4e07"
                                          d="M530.8 134.1C545.1 144.5 548.3 164.5 537.9 178.8L281.9 530.8C276.4 538.4 267.9 543.1 258.5 543.9C249.1 544.7 240 541.2 233.4 534.6L105.4 406.6C92.9 394.1 92.9 373.8 105.4 361.3C117.9 348.8 138.2 348.8 150.7 361.3L252.2 462.8L486.2 141.1C496.6 126.8 516.6 123.6 530.9 134z"/>
                                </svg>
                            {% elseif app.user and app.user.id == sortie.organisateur.id %}
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="#1464aa" d="M320 312C253.7 312 200 258.3 200 192C200 125.7 253.7 72 320 72C386.3 72 440 125.7 440 192C440 258.3 386.3 312 320 312zM289.5 368L350.5 368C360.2 368 368 375.8 368 385.5C368 389.7 366.5 393.7 363.8 396.9L336.4 428.9L367.4 544L368 544L402.6 405.5C404.8 396.8 413.7 391.5 422.1 394.7C484 418.3 528 478.3 528 548.5C528 563.6 515.7 575.9 500.6 575.9L139.4 576C124.3 576 112 563.7 112 548.6C112 478.4 156 418.4 217.9 394.8C226.3 391.6 235.2 396.9 237.4 405.6L272 544.1L272.6 544.1L303.6 429L276.2 397C273.5 393.8 272 389.8 272 385.6C272 375.9 279.8 368.1 289.5 368.1z"/></svg>
                            {% else %}
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="#a80f0f" d="M183.1 137.4C170.6 124.9 150.3 124.9 137.8 137.4C125.3 149.9 125.3 170.2 137.8 182.7L275.2 320L137.9 457.4C125.4 469.9 125.4 490.2 137.9 502.7C150.4 515.2 170.7 515.2 183.2 502.7L320.5 365.3L457.9 502.6C470.4 515.1 490.7 515.1 503.2 502.6C515.7 490.1 515.7 469.8 503.2 457.3L365.8 320L503.1 182.6C515.6 170.1 515.6 149.8 503.1 137.3C490.6 124.8 470.3 124.8 457.8 137.3L320.5 274.7L183.1 137.4z"/></svg>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{{ path('app_edit', {'id': sortie.organisateur.id}) }}">{{ sortie.organisateur.prenom }}</a>
                        </td>
                        <td style="display: flex; justify-content: center;">
                            <a class="generic-button bouton-info-color" href="{{ path('app_sortie_details', {id: sortie.id}) }}"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="#ffffff" d="M272 112C272 85.5 293.5 64 320 64C346.5 64 368 85.5 368 112C368 138.5 346.5 160 320 160C293.5 160 272 138.5 272 112zM224 256C224 238.3 238.3 224 256 224L320 224C337.7 224 352 238.3 352 256L352 512L384 512C401.7 512 416 526.3 416 544C416 561.7 401.7 576 384 576L256 576C238.3 576 224 561.7 224 544C224 526.3 238.3 512 256 512L288 512L288 288L256 288C238.3 288 224 273.7 224 256z"/></svg></a>

                            {% if app.user and sortie.organisateur.id == app.user.id or is_granted('ROLE_ADMIN') %}

                                {% if sortie.etat.libelle == "Créée" %}
                                    <a class="generic-button bouton-secondary-color" href="{{ path('app_sortie_modifier', {id: sortie.id}) }}"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="#ffffff" d="M535.6 85.7C513.7 63.8 478.3 63.8 456.4 85.7L432 110.1L529.9 208L554.3 183.6C576.2 161.7 576.2 126.3 554.3 104.4L535.6 85.7zM236.4 305.7C230.3 311.8 225.6 319.3 222.9 327.6L193.3 416.4C190.4 425 192.7 434.5 199.1 441C205.5 447.5 215 449.7 223.7 446.8L312.5 417.2C320.7 414.5 328.2 409.8 334.4 403.7L496 241.9L398.1 144L236.4 305.7zM160 128C107 128 64 171 64 224L64 480C64 533 107 576 160 576L416 576C469 576 512 533 512 480L512 384C512 366.3 497.7 352 480 352C462.3 352 448 366.3 448 384L448 480C448 497.7 433.7 512 416 512L160 512C142.3 512 128 497.7 128 480L128 224C128 206.3 142.3 192 160 192L256 192C273.7 192 288 177.7 288 160C288 142.3 273.7 128 256 128L160 128z"/></svg></a>
                                {% endif %}

                                {% if sortie.etat.libelle != "Activitée en cours" and sortie.etat.libelle != "Passée" and sortie.etat.libelle != "Annulée" %}
                                    <a class="generic-button bouton-danger-color" href="{{ path('app_sortie_annuler', {'id': sortie.id}) }}"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="#ffffff" d="M183.1 137.4C170.6 124.9 150.3 124.9 137.8 137.4C125.3 149.9 125.3 170.2 137.8 182.7L275.2 320L137.9 457.4C125.4 469.9 125.4 490.2 137.9 502.7C150.4 515.2 170.7 515.2 183.2 502.7L320.5 365.3L457.9 502.6C470.4 515.1 490.7 515.1 503.2 502.6C515.7 490.1 515.7 469.8 503.2 457.3L365.8 320L503.1 182.6C515.6 170.1 515.6 149.8 503.1 137.3C490.6 124.8 470.3 124.8 457.8 137.3L320.5 274.7L183.1 137.4z"/></svg></a>
                                {% endif %}

                            {% endif %}

                            {% if app.user and sortie.organisateur.id != app.user.id %}
                                {% if sortie.etat.libelle == "Ouverte" %}
                                    {% if app.user and not sortie.estInscrit(app.user)  %}
                                        <form method="post" action="{{ path('app_home_sinscrire', {'id': sortie.id}) }}">
                                            <input type="hidden" name="_token" value="{{ csrf_token('sinscrire'~sortie.id) }}">
                                            <button class="generic-button bouton-secondary-color" type="submit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="#ffffff" d="M136 192C136 125.7 189.7 72 256 72C322.3 72 376 125.7 376 192C376 258.3 322.3 312 256 312C189.7 312 136 258.3 136 192zM48 546.3C48 447.8 127.8 368 226.3 368L285.7 368C384.2 368 464 447.8 464 546.3C464 562.7 450.7 576 434.3 576L77.7 576C61.3 576 48 562.7 48 546.3zM544 160C557.3 160 568 170.7 568 184L568 232L616 232C629.3 232 640 242.7 640 256C640 269.3 629.3 280 616 280L568 280L568 328C568 341.3 557.3 352 544 352C530.7 352 520 341.3 520 328L520 280L472 280C458.7 280 448 269.3 448 256C448 242.7 458.7 232 472 232L520 232L520 184C520 170.7 530.7 160 544 160z"/></svg></button>
                                        </form>
                                    {% endif %}

                                    {% if app.user and sortie.estInscrit(app.user) %}
                                        <form method="post" action="{{ path('app_home_desinscrire', {'id': sortie.id}) }}">
                                            <input type="hidden" name="_token" value="{{ csrf_token('desinscrire'~sortie.id) }}">
                                            <button class="generic-button bouton-warning-color" type="submit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="#ffffff" d="M136 192C136 125.7 189.7 72 256 72C322.3 72 376 125.7 376 192C376 258.3 322.3 312 256 312C189.7 312 136 258.3 136 192zM48 546.3C48 447.8 127.8 368 226.3 368L285.7 368C384.2 368 464 447.8 464 546.3C464 562.7 450.7 576 434.3 576L77.7 576C61.3 576 48 562.7 48 546.3zM472 232L616 232C629.3 232 640 242.7 640 256C640 269.3 629.3 280 616 280L472 280C458.7 280 448 269.3 448 256C448 242.7 458.7 232 472 232z"/></svg></button>
                                        </form>
                                    {% endif %}
                                {% endif %}
                            {% endif %}

                        </td>
                    </tr>
                {% else %}
                    <tr><td colspan="8" class="text-center">Aucune sortie trouvée</td></tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

        <a href="sortie/creer" class="generic-button bouton-secondary-color" style="margin-top: 1em">Créer une sortie</a>
    </div>
{% endblock %}
